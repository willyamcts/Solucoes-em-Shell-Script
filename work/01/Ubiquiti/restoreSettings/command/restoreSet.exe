
# Em funcoes que retornam valores, para fins de relatório, devem retornar:
#	- 1o = O conteudo;
#	- 2o = O retorno da sua execucao;
# 	* Amabas em um único "echo", separados por "+":
#		ex: echo "$report+$return"
######################################################

##### FUNCOES PADROES PARA ACESSO VIA SSH - USO: #####
#						     #
#	$(connectSSHp22 "$1" "$2" "$3" '[comandos]' )#

# Padrao conexao SSH na porta 22
connectSSHp22() {
	sshpass -p "$2" ssh -p22 -o 'UserKnownHostsFile=/dev/null' -o 'ServerAliveCountMax=2' \
		-o 'ServerAliveInterval=10' \
			-o 'ConnectTimeout=10' \
				-o 'StrictHostKeyChecking no' $1@$3 $4 1>&2>/dev/null
}

# Padrao conexao SSH na porta 7722
connectSSHp7722() {
	sshpass -p "$2" ssh -p7722 -o 'UserKnownHostsFile=/dev/null' \
		-o 'ServerAliveCountMax=2' -o 'ServerAliveInterval=10' \
			-o 'ConnectTimeout=10' \
				-o 'StrictHostKeyChecking no' $1@$3 $4 1>&2>/dev/null
}


#######################################################

backupUbiquiti() {
#	netconf.3.ip= #LINHA COM IP
#	resolv.host.1.name= #LINHA COM NOME DO DISPOSITIVO

	sshpass -p "$2" scp -P22 -o 'ServerAliveCountMax=2' \
		-o 'ServerAliveInterval=10' \
			-o 'ConnectTimeout=10' \
				-o 'StrictHostKeyChecking no' $1@$3:/tmp/system.cfg "$4/" 1>&2>/dev/null

	out=$(echo $?)


	if [ $out = 255 ]; then
		sshpass -p "$2" scp -P22 -o 'ServerAliveCountMax=2' \
		-o 'ServerAliveInterval=10' \
			-o 'ConnectTimeout=10' \
				-o 'StrictHostKeyChecking no' $1@$3:/tmp/system.cfg "$4/" 1>&2>/dev/null

		out=$(echo $?)


		if [ $out = 255 ]; then
			sshpass -p "$2" scp -P22 -o 'ServerAliveCountMax=2' \
				-o 'ServerAliveInterval=10' \
					-o 'ConnectTimeout=10' \
						-o 'StrictHostKeyChecking no' -o 'KexAlgorithms=+diffie-hellman-group1-sha1' $1@$3:/tmp/system.cfg "$4/" 1>&2>/dev/null

			out=$(echo $?)
		fi
	fi


	if [[ $out = 255 || $out = 1 ]]; then
		sshpass -p "$2" scp -P7722 -o 'ServerAliveCountMax=2' \
			-o 'ServerAliveInterval=10' \
				-o 'ConnectTimeout=10' \
					-o 'StrictHostKeyChecking no' $1@$3:/tmp/system.cfg "$4/" 1>&2>/dev/null

		out=$(echo $?)

		if [ $out = 255 ]; then
			sshpass -p "$2" scp -P7722 -o 'ServerAliveCountMax=2' \
				-o 'ServerAliveInterval=10' \
					-o 'ConnectTimeout=10' \
						-o 'StrictHostKeyChecking no' -o 'KexAlgorithms=+diffie-hellman-group1-sha1' $1@$3:/tmp/system.cfg "$4/" 1>&2>/dev/null

			out=$(echo $?)
		fi

	fi



#Removendo ":" e alterando caracteres para upper case
#arp -a | grep 192.168.1.20 | cut -d" " -f4 | tr -d ':' | tr [:lower:] [:upper:]



	# Execucao Local
	if [ $out = 0 ]; then
		run=$(cat $4/system.cfg | grep resolv.host.1.name | cut -d= -f2)
		run=$(echo "$run-`cat $4/system.cfg | grep netconf.3.ip= | cut -d= -f2`")

		mv "$4/system.cfg" "$4/$run.cfg"

		out=$(echo $?)

	fi

	echo "$run+$out"

unset run out
}
